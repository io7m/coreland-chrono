#include <stdio.h>
#include "t_assert.h"
#include "t_util.h"
#include "../caldate.h"

static const struct {
  struct caldate cd;
  unsigned int len;
  const char *s;
} tests[] = {
  { { 0, 0, 0 }, 7, "0-00-00" },
  { { 0x7fffffff, 0xffff, 0xffff }, 22, "2147483647-65535-65535" }, 
  { { 0, 1, 1 }, 7, "0-01-01" },
  { { 1, 1, 1 }, 7, "1-01-01" },
  { { -1, 1, 1 }, 8, "-1-01-01" },

  /* automatically generated, do not edit */
  { { 2140165000, -2, 1 }, 17, "2140165000--02-01" },
  { { -940407099, 6, 26 }, 16, "-940407099-06-26" },
  { { -1506793243, -13, -27 }, 19, "-1506793243--13--27" },
  { { 847742799, -7, 1 }, 16, "847742799--07-01" },
  { { 961470017, -4, 22 }, 16, "961470017--04-22" },
  { { -1445585422, 12, -26 }, 18, "-1445585422-12--26" },
  { { -790223482, 9, -16 }, 17, "-790223482-09--16" },
  { { -851382253, 11, 9 }, 16, "-851382253-11-09" },
  { { -1834424933, -5, 0 }, 18, "-1834424933--05-00" },
  { { 482665996, 9, -13 }, 16, "482665996-09--13" },
  { { -1675362814, 6, 23 }, 17, "-1675362814-06-23" },
  { { -799356473, -9, -17 }, 18, "-799356473--09--17" },
  { { 365809164, -10, -16 }, 17, "365809164--10--16" },
  { { -1274101276, 7, -5 }, 18, "-1274101276-07--05" },
  { { -1756960397, -0, 11 }, 17, "-1756960397-00-11" },
  { { -1663111926, -3, 23 }, 18, "-1663111926--03-23" },
  { { 1684181965, -12, -24 }, 18, "1684181965--12--24" },
  { { -1454668233, 9, -23 }, 18, "-1454668233-09--23" },
  { { -1903144139, -1, -23 }, 19, "-1903144139--01--23" },
  { { -996390843, -11, -6 }, 18, "-996390843--11--06" },
  { { -1838540545, -6, 4 }, 18, "-1838540545--06-04" },
  { { -2043619361, -11, 27 }, 18, "-2043619361--11-27" },
  { { -1133544721, 5, -29 }, 18, "-1133544721-05--29" },
  { { -83419332, 0, 23 }, 15, "-83419332-00-23" },
  { { 1357857557, -6, 11 }, 17, "1357857557--06-11" },
  { { -819685657, 10, -3 }, 17, "-819685657-10--03" },
  { { 229698320, 4, -12 }, 16, "229698320-04--12" },
  { { 1507610009, -7, 28 }, 17, "1507610009--07-28" },
  { { 112840559, -7, 14 }, 16, "112840559--07-14" },
  { { -2981394, 6, -2 }, 15, "-2981394-06--02" },
  { { -128116597, -1, -10 }, 18, "-128116597--01--10" },
  { { -311264927, 0, 29 }, 16, "-311264927-00-29" },
  { { 12670, 9, -11 }, 12, "12670-09--11" },
  { { -13036, -1, 16 }, 13, "-13036--01-16" },
  { { -13179, 10, -26 }, 13, "-13179-10--26" },
  { { 9368, -5, 2 }, 11, "9368--05-02" },
  { { -6500, -0, -23 }, 12, "-6500-00--23" },
  { { 21003, 1, -19 }, 12, "21003-01--19" },
  { { 1621, 12, -13 }, 11, "1621-12--13" },
  { { 4929, 9, 6 }, 10, "4929-09-06" },
  { { 30428, 12, 26 }, 11, "30428-12-26" },
  { { 10530, 4, 3 }, 11, "10530-04-03" },
  { { -30354, 9, 23 }, 12, "-30354-09-23" },
  { { -7908, -3, 27 }, 12, "-7908--03-27" },
  { { -6653, -9, 3 }, 12, "-6653--09-03" },
  { { 16679, -8, 3 }, 12, "16679--08-03" },
  { { -5758, 1, -12 }, 12, "-5758-01--12" },
  { { 7640, 3, -17 }, 11, "7640-03--17" },
  { { -19778, 0, 20 }, 12, "-19778-00-20" },
  { { 21340, -10, -10 }, 13, "21340--10--10" },
  { { -24674, 8, 19 }, 12, "-24674-08-19" },
  { { -32572, -8, 8 }, 13, "-32572--08-08" },
  { { 15062, -10, 4 }, 12, "15062--10-04" },
  { { 3172, -3, 10 }, 11, "3172--03-10" },
  { { -24304, -1, 10 }, 13, "-24304--01-10" },
  { { 7300, -9, 21 }, 11, "7300--09-21" },
  { { -31152, -12, 16 }, 13, "-31152--12-16" },
  { { -10377, -6, 4 }, 13, "-10377--06-04" },
  { { 10345, -5, -20 }, 13, "10345--05--20" },
  { { -23632, 8, -16 }, 13, "-23632-08--16" },
  { { 8718, -13, -18 }, 12, "8718--13--18" },
  { { -3264, -1, 1 }, 12, "-3264--01-01" },
  { { -18779, 9, -10 }, 13, "-18779-09--10" },
  { { 2007, -11, -11 }, 12, "2007--11--11" },
  { { -392, -9, 10 }, 11, "-392--09-10" },
  { { -636, -7, -19 }, 12, "-636--07--19" },
  { { 581, -5, 5 }, 10, "581--05-05" },
  { { 301, -5, 28 }, 10, "301--05-28" },
  { { -584, -8, 7 }, 11, "-584--08-07" },
  { { -287, 1, -10 }, 11, "-287-01--10" },
  { { -319, -6, -18 }, 12, "-319--06--18" },
  { { -705, -3, -3 }, 12, "-705--03--03" },
  { { -557, -13, 24 }, 11, "-557--13-24" },
  { { 871, 1, -29 }, 10, "871-01--29" },
  { { 179, -7, -21 }, 11, "179--07--21" },
  { { 609, -13, 28 }, 10, "609--13-28" },
  { { -660, 8, 13 }, 10, "-660-08-13" },
  { { 832, 10, 18 }, 9, "832-10-18" },
  { { 903, -12, 24 }, 10, "903--12-24" },
  { { -14, -10, -7 }, 11, "-14--10--07" },
  { { -407, -13, 21 }, 11, "-407--13-21" },
  { { -848, 12, -18 }, 11, "-848-12--18" },
  { { -843, 4, 20 }, 10, "-843-04-20" },
  { { 413, 12, -26 }, 10, "413-12--26" },
  { { -742, -0, 22 }, 10, "-742-00-22" },
  { { 829, 2, -26 }, 10, "829-02--26" },
  { { -964, 11, -4 }, 11, "-964-11--04" },
  { { -72, -10, -2 }, 11, "-72--10--02" },
  { { -571, 10, 11 }, 10, "-571-10-11" },
  { { -789, 8, -4 }, 11, "-789-08--04" },
  { { -212, -0, -21 }, 11, "-212-00--21" },
  { { 358, 11, 17 }, 9, "358-11-17" },
  { { -611, -3, 4 }, 11, "-611--03-04" },
  { { 758, 12, -7 }, 10, "758-12--07" },
  { { 591, 4, -22 }, 10, "591-04--22" },
  { { 417, -8, -22 }, 11, "417--08--22" },
  { { -366, 2, 23 }, 10, "-366-02-23" },
  { { 992, 11, 21 }, 9, "992-11-21" },
  { { -143, 12, 26 }, 10, "-143-12-26" },
  { { -565, 6, 18 }, 10, "-565-06-18" },
  { { -884, 9, 9 }, 10, "-884-09-09" },
  { { -510, 11, 20 }, 10, "-510-11-20" },
  { { 684, 8, 28 }, 9, "684-08-28" },
  { { 46, 1, 27 }, 8, "46-01-27" },
  { { 135, 5, 19 }, 9, "135-05-19" },
  { { 250, 8, 26 }, 9, "250-08-26" },
  { { -266, 7, 8 }, 10, "-266-07-08" },
  { { -946, 1, 13 }, 10, "-946-01-13" },
  { { 346, 4, 22 }, 9, "346-04-22" },
  { { 352, 7, 6 }, 9, "352-07-06" },
  { { 575, 6, 11 }, 9, "575-06-11" },
  { { -351, 9, 25 }, 10, "-351-09-25" },
  { { 205, 5, 2 }, 9, "205-05-02" },
  { { -290, 4, 29 }, 10, "-290-04-29" },
  { { 221, 3, 2 }, 9, "221-03-02" },
  { { 646, 8, 22 }, 9, "646-08-22" },
  { { 271, 10, 7 }, 9, "271-10-07" },
  { { 486, 12, 15 }, 9, "486-12-15" },
  { { -214, 6, 21 }, 10, "-214-06-21" },
  { { 750, 2, 11 }, 9, "750-02-11" },
  { { -563, 11, 19 }, 10, "-563-11-19" },
  { { -747, 8, 11 }, 10, "-747-08-11" },
  { { -91, 2, 17 }, 9, "-91-02-17" },
  { { 243, 8, 22 }, 9, "243-08-22" },
  { { 79, 3, 17 }, 8, "79-03-17" },
  { { -113, 7, 5 }, 10, "-113-07-05" },
  { { -479, 8, 12 }, 10, "-479-08-12" },
  { { -372, 3, 10 }, 10, "-372-03-10" },
};

int main(void)
{
  char cdate[CALDATE_FMT];
  unsigned long ind;
  unsigned int len;

  test_assert_verbose = 0;
  for (ind = 0; ind < sizeof(tests) / sizeof(tests[0]); ++ind) {
    cdate[caldate_fmt(cdate, &tests[ind].cd)] = 0;
    printf("[%lu] (%s) %s %u\n", ind, cdate, tests[ind].s, tests[ind].len);
    test_assert(t_str_same(tests[ind].s, cdate));
    len = caldate_fmt(0, &tests[ind].cd);
    test_assert(len == tests[ind].len);
  }

  return 0;
}
