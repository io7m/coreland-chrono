
#include <stdio.h>
#include "t_assert.h"
#include "t_util.h"
#include "../caltime.h"

static const struct {
  struct caltime ct;
  unsigned int len;
  const char *s;
} tests[] = {
  /* automatically generated, do not edit */
  { { { -624529168, -7, 1 }, 10, 15, 15, 168 }, 32, "-624529168--07-01 10:15:15 +0168" },
  { { { -75088061, -1, 18 }, 5, 28, 1, -602 }, 31, "-75088061--01-18 05:28:01 -0602" },
  { { { 941623570, -5, -24 }, 7, 36, 23, 764 }, 32, "941623570--05--24 07:36:23 +0764" },
  { { { 1339811010, 9, 4 }, 1, 39, 14, 975 }, 31, "1339811010-09-04 01:39:14 +0975" },
  { { { 343377618, -9, 16 }, 18, 4, 3, 306 }, 31, "343377618--09-16 18:04:03 +0306" },
  { { { -2135881779, 12, 1 }, 16, 30, 2, -569 }, 32, "-2135881779-12-01 16:30:02 -0569" },
  { { { 469317996, -12, 21 }, 6, 16, 47, -920 }, 31, "469317996--12-21 06:16:47 -0920" },
  { { { 2127431704, -7, 19 }, 5, 54, 16, 166 }, 32, "2127431704--07-19 05:54:16 +0166" },
  { { { 939582755, 6, 14 }, 11, 47, 40, -288 }, 30, "939582755-06-14 11:47:40 -0288" },
  { { { 560409374, 6, 29 }, 12, 46, 4, -235 }, 30, "560409374-06-29 12:46:04 -0235" },
  { { { -1046551657, 5, -21 }, 15, 10, 5, 580 }, 33, "-1046551657-05--21 15:10:05 +0580" },
  { { { 1254514061, -2, 2 }, 13, 48, 55, -557 }, 32, "1254514061--02-02 13:48:55 -0557" },
  { { { -492907521, 8, -4 }, 1, 6, 1, -194 }, 32, "-492907521-08--04 01:06:01 -0194" },
  { { { 1182718344, -12, 22 }, 18, 2, 8, -164 }, 32, "1182718344--12-22 18:02:08 -0164" },
  { { { 985904819, 2, 22 }, 18, 53, 23, 576 }, 30, "985904819-02-22 18:53:23 +0576" },
  { { { -785089055, 3, 19 }, 18, 47, 40, -523 }, 31, "-785089055-03-19 18:47:40 -0523" },
  { { { -1857335847, 12, 23 }, 20, 44, 45, 313 }, 32, "-1857335847-12-23 20:44:45 +0313" },
  { { { 1947951052, -7, 3 }, 23, 44, 5, 317 }, 32, "1947951052--07-03 23:44:05 +0317" },
  { { { -146175008, 8, 7 }, 22, 36, 9, -406 }, 31, "-146175008-08-07 22:36:09 -0406" },
  { { { -1318222704, 1, -11 }, 8, 28, 9, 929 }, 33, "-1318222704-01--11 08:28:09 +0929" },
  { { { -489978035, 4, -16 }, 24, 17, 3, 503 }, 32, "-489978035-04--16 24:17:03 +0503" },
  { { { -487147764, 5, 0 }, 23, 45, 13, 652 }, 31, "-487147764-05-00 23:45:13 +0652" },
  { { { -794063928, -11, 17 }, 10, 47, 49, 319 }, 32, "-794063928--11-17 10:47:49 +0319" },
  { { { -1893711740, -7, -13 }, 24, 38, 1, 717 }, 34, "-1893711740--07--13 24:38:01 +0717" },
  { { { -398433475, -9, 11 }, 5, 16, 7, 338 }, 32, "-398433475--09-11 05:16:07 +0338" },
  { { { -1539384861, 4, 3 }, 9, 46, 42, 392 }, 32, "-1539384861-04-03 09:46:42 +0392" },
  { { { 1879298439, -9, -4 }, 19, 2, 4, 283 }, 33, "1879298439--09--04 19:02:04 +0283" },
  { { { -793019480, 9, 21 }, 16, 58, 29, 177 }, 31, "-793019480-09-21 16:58:29 +0177" },
  { { { -438330381, 4, -10 }, 9, 31, 29, -45 }, 32, "-438330381-04--10 09:31:29 -0045" },
  { { { -997469014, -12, -23 }, 1, 33, 59, -931 }, 33, "-997469014--12--23 01:33:59 -0931" },
  { { { -1448500172, 1, -11 }, 15, 48, 41, -412 }, 33, "-1448500172-01--11 15:48:41 -0412" },
  { { { -1150610338, -4, -12 }, 18, 32, 13, -852 }, 34, "-1150610338--04--12 18:32:13 -0852" },
  { { { 28199, -10, -5 }, 16, 18, 20, 101 }, 28, "28199--10--05 16:18:20 +0101" },
  { { { 14951, -2, -9 }, 24, 5, 2, -94 }, 28, "14951--02--09 24:05:02 -0094" },
  { { { 6696, 5, -2 }, 18, 0, 13, 851 }, 26, "6696-05--02 18:00:13 +0851" },
  { { { -10349, 8, 14 }, 22, 29, 34, -667 }, 27, "-10349-08-14 22:29:34 -0667" },
  { { { -31586, -4, 24 }, 0, 7, 34, 243 }, 28, "-31586--04-24 00:07:34 +0243" },
  { { { 8267, -11, -24 }, 9, 9, 30, 531 }, 27, "8267--11--24 09:09:30 +0531" },
  { { { 28198, 9, -24 }, 12, 35, 33, -498 }, 27, "28198-09--24 12:35:33 -0498" },
  { { { -29413, 5, 19 }, 10, 2, 46, -328 }, 27, "-29413-05-19 10:02:46 -0328" },
  { { { -26820, 9, -27 }, 8, 31, 26, 741 }, 28, "-26820-09--27 08:31:26 +0741" },
  { { { 27420, -4, 3 }, 11, 10, 9, 253 }, 27, "27420--04-03 11:10:09 +0253" },
  { { { 22638, 9, -20 }, 8, 2, 48, -268 }, 27, "22638-09--20 08:02:48 -0268" },
  { { { 31804, -2, -14 }, 20, 2, 19, 801 }, 28, "31804--02--14 20:02:19 +0801" },
  { { { -26588, 4, 13 }, 5, 27, 21, 647 }, 27, "-26588-04-13 05:27:21 +0647" },
  { { { 13200, -3, -6 }, 20, 44, 5, 826 }, 28, "13200--03--06 20:44:05 +0826" },
  { { { -14249, -12, 29 }, 20, 36, 45, 494 }, 28, "-14249--12-29 20:36:45 +0494" },
  { { { -24249, 5, -9 }, 1, 46, 27, -901 }, 28, "-24249-05--09 01:46:27 -0901" },
  { { { 16073, 6, -15 }, 2, 59, 58, 54 }, 27, "16073-06--15 02:59:58 +0054" },
  { { { 11648, -8, -19 }, 6, 13, 24, 830 }, 28, "11648--08--19 06:13:24 +0830" },
  { { { -26071, -8, 11 }, 16, 30, 51, -444 }, 28, "-26071--08-11 16:30:51 -0444" },
  { { { 19451, -6, 25 }, 6, 38, 38, -217 }, 27, "19451--06-25 06:38:38 -0217" },
  { { { -12669, 7, -0 }, 20, 46, 55, -563 }, 27, "-12669-07-00 20:46:55 -0563" },
  { { { 28814, -9, -16 }, 8, 52, 15, -172 }, 28, "28814--09--16 08:52:15 -0172" },
  { { { 18418, -12, 23 }, 19, 45, 23, 824 }, 27, "18418--12-23 19:45:23 +0824" },
  { { { 21402, 8, -1 }, 14, 59, 40, -113 }, 27, "21402-08--01 14:59:40 -0113" },
  { { { -6898, -2, 28 }, 15, 18, 3, -538 }, 27, "-6898--02-28 15:18:03 -0538" },
  { { { 28963, 2, -7 }, 16, 7, 13, 135 }, 27, "28963-02--07 16:07:13 +0135" },
  { { { 14752, 7, -14 }, 15, 27, 15, 913 }, 27, "14752-07--14 15:27:15 +0913" },
  { { { 30131, 11, -2 }, 22, 3, 13, -153 }, 27, "30131-11--02 22:03:13 -0153" },
  { { { 13216, 8, -24 }, 19, 58, 35, -684 }, 27, "13216-08--24 19:58:35 -0684" },
  { { { 12106, 4, -22 }, 14, 19, 30, 670 }, 27, "12106-04--22 14:19:30 +0670" },
  { { { 31169, -9, 15 }, 9, 32, 53, 139 }, 27, "31169--09-15 09:32:53 +0139" },
  { { { -18672, -6, 11 }, 13, 37, 42, 297 }, 28, "-18672--06-11 13:37:42 +0297" },
  { { { 374, -11, -3 }, 1, 42, 35, -15 }, 26, "374--11--03 01:42:35 -0015" },
  { { { -535, -8, -11 }, 20, 8, 19, -706 }, 27, "-535--08--11 20:08:19 -0706" },
  { { { 131, 11, -1 }, 1, 12, 5, -523 }, 25, "131-11--01 01:12:05 -0523" },
  { { { -754, 10, 1 }, 7, 24, 18, 817 }, 25, "-754-10-01 07:24:18 +0817" },
  { { { -194, -2, 16 }, 18, 0, 49, -820 }, 26, "-194--02-16 18:00:49 -0820" },
  { { { -335, -4, 10 }, 23, 51, 59, -155 }, 26, "-335--04-10 23:51:59 -0155" },
  { { { 555, -6, -23 }, 7, 44, 49, -866 }, 26, "555--06--23 07:44:49 -0866" },
  { { { -351, 11, -11 }, 16, 8, 8, -882 }, 26, "-351-11--11 16:08:08 -0882" },
  { { { 266, 8, -0 }, 11, 39, 9, 125 }, 24, "266-08-00 11:39:09 +0125" },
  { { { 330, -6, -27 }, 16, 12, 57, 503 }, 26, "330--06--27 16:12:57 +0503" },
  { { { -543, 11, -12 }, 16, 23, 11, -431 }, 26, "-543-11--12 16:23:11 -0431" },
  { { { 432, 0, 26 }, 24, 38, 23, 106 }, 24, "432-00-26 24:38:23 +0106" },
  { { { 99, -5, 20 }, 20, 39, 40, 235 }, 24, "99--05-20 20:39:40 +0235" },
  { { { 685, 3, -9 }, 14, 5, 15, -919 }, 25, "685-03--09 14:05:15 -0919" },
  { { { 175, 13, -27 }, 17, 8, 56, -56 }, 25, "175-13--27 17:08:56 -0056" },
  { { { -188, 13, -21 }, 10, 8, 42, 376 }, 26, "-188-13--21 10:08:42 +0376" },
  { { { 572, -11, 0 }, 18, 17, 42, 314 }, 25, "572--11-00 18:17:42 +0314" },
  { { { 975, 3, 26 }, 20, 35, 49, 543 }, 24, "975-03-26 20:35:49 +0543" },
  { { { -981, -8, 27 }, 15, 47, 47, 928 }, 26, "-981--08-27 15:47:47 +0928" },
  { { { -493, 9, -1 }, 22, 1, 0, 810 }, 26, "-493-09--01 22:01:00 +0810" },
  { { { -257, -8, 24 }, 9, 45, 14, -635 }, 26, "-257--08-24 09:45:14 -0635" },
  { { { -48, 12, -10 }, 5, 33, 41, -319 }, 25, "-48-12--10 05:33:41 -0319" },
  { { { 757, -8, 5 }, 9, 3, 14, 22 }, 25, "757--08-05 09:03:14 +0022" },
  { { { 989, 4, 28 }, 18, 12, 27, 589 }, 24, "989-04-28 18:12:27 +0589" },
  { { { 858, -8, 0 }, 7, 19, 11, -884 }, 25, "858--08-00 07:19:11 -0884" },
  { { { 881, -3, -27 }, 19, 53, 52, -235 }, 26, "881--03--27 19:53:52 -0235" },
  { { { -284, -8, -21 }, 24, 7, 60, -510 }, 27, "-284--08--21 24:07:60 -0510" },
  { { { 411, 4, 2 }, 7, 31, 57, -780 }, 24, "411-04-02 07:31:57 -0780" },
  { { { 261, -2, 0 }, 15, 10, 12, -31 }, 25, "261--02-00 15:10:12 -0031" },
  { { { 852, 9, 6 }, 20, 26, 31, 148 }, 24, "852-09-06 20:26:31 +0148" },
  { { { -636, 10, -4 }, 14, 23, 34, -470 }, 26, "-636-10--04 14:23:34 -0470" },
  { { { 119, 4, 28 }, 21, 38, 37, 145 }, 24, "119-04-28 21:38:37 +0145" },
  { { { -699, 5, 21 }, 13, 13, 26, 812 }, 25, "-699-05-21 13:13:26 +0812" },
  { { { 771, 3, 21 }, 12, 53, 24, 996 }, 24, "771-03-21 12:53:24 +0996" },
  { { { -768, 5, 18 }, 21, 23, 42, 243 }, 25, "-768-05-18 21:23:42 +0243" },
  { { { 166, 7, 10 }, 5, 55, 41, 214 }, 24, "166-07-10 05:55:41 +0214" },
  { { { 534, 3, 22 }, 14, 20, 3, 749 }, 24, "534-03-22 14:20:03 +0749" },
  { { { -356, 9, 27 }, 5, 4, 16, 427 }, 25, "-356-09-27 05:04:16 +0427" },
  { { { -603, 12, 3 }, 16, 5, 39, 952 }, 25, "-603-12-03 16:05:39 +0952" },
  { { { -589, 0, 27 }, 23, 28, 28, 599 }, 25, "-589-00-27 23:28:28 +0599" },
  { { { -478, 0, 6 }, 10, 6, 59, 956 }, 25, "-478-00-06 10:06:59 +0956" },
  { { { 657, 6, 7 }, 6, 23, 18, 460 }, 24, "657-06-07 06:23:18 +0460" },
  { { { -827, 7, 25 }, 19, 41, 37, 36 }, 25, "-827-07-25 19:41:37 +0036" },
  { { { 337, 3, 14 }, 4, 49, 57, 878 }, 24, "337-03-14 04:49:57 +0878" },
  { { { 203, 11, 2 }, 3, 26, 55, 561 }, 24, "203-11-02 03:26:55 +0561" },
  { { { -108, 10, 5 }, 13, 1, 28, 609 }, 25, "-108-10-05 13:01:28 +0609" },
  { { { -960, 1, 27 }, 17, 36, 56, 783 }, 25, "-960-01-27 17:36:56 +0783" },
  { { { -130, 5, 1 }, 8, 59, 32, 201 }, 25, "-130-05-01 08:59:32 +0201" },
  { { { -488, 7, 14 }, 14, 5, 22, 923 }, 25, "-488-07-14 14:05:22 +0923" },
  { { { -781, 2, 26 }, 20, 17, 59, 37 }, 25, "-781-02-26 20:17:59 +0037" },
  { { { 933, 2, 25 }, 9, 39, 53, 68 }, 24, "933-02-25 09:39:53 +0068" },
  { { { -442, 9, 6 }, 6, 9, 10, 365 }, 25, "-442-09-06 06:09:10 +0365" },
  { { { 827, 9, 19 }, 23, 24, 22, 218 }, 24, "827-09-19 23:24:22 +0218" },
  { { { -232, 12, 25 }, 20, 43, 23, 135 }, 25, "-232-12-25 20:43:23 +0135" },
  { { { 848, 10, 24 }, 16, 51, 41, 260 }, 24, "848-10-24 16:51:41 +0260" },
  { { { 255, 11, 16 }, 10, 52, 0, 797 }, 24, "255-11-16 10:52:00 +0797" },
  { { { 201, 2, 28 }, 16, 59, 43, 861 }, 24, "201-02-28 16:59:43 +0861" },
  { { { 668, 6, 8 }, 19, 18, 37, 656 }, 24, "668-06-08 19:18:37 +0656" },
  { { { 442, 4, 4 }, 13, 26, 8, 190 }, 24, "442-04-04 13:26:08 +0190" },
  { { { -909, 7, 17 }, 11, 40, 27, 312 }, 25, "-909-07-17 11:40:27 +0312" },
  { { { 243, 10, 12 }, 0, 23, 16, 761 }, 24, "243-10-12 00:23:16 +0761" },
  { { { -633, 0, 15 }, 15, 14, 8, 864 }, 25, "-633-00-15 15:14:08 +0864" },
  { { { -989, 8, 16 }, 13, 28, 48, 64 }, 25, "-989-08-16 13:28:48 +0064" },
  { { { 730, 3, 26 }, 4, 6, 3, 601 }, 24, "730-03-26 04:06:03 +0601" },
};

int main(void)
{
  char cdate[CALDATE_FMT];
  unsigned long ind;
  unsigned int len;

  test_assert_verbose = 0;
  for (ind = 0; ind < sizeof(tests) / sizeof(tests[0]); ++ind) {
    cdate[caltime_fmt(cdate, &tests[ind].ct)] = 0;
    printf("[%lu] (%s) %s %u\n",
             ind, cdate, tests[ind].s, tests[ind].len);
    test_assert(t_str_same(tests[ind].s, cdate));
    len = caltime_fmt(0, &tests[ind].ct);
    test_assert(len == tests[ind].len);
  }

  return 0;
}
